<div id="controls-wrapper">
    <div id="controls" class="leaflet-popup-content-wrapper" style="position:absolute">
        <table class="leaflet-popup-content">
            <tr><td>起始地點: </td><td id="startloc"></td></tr>
            <tr>
                <td>起始時間: </td>
                <td>
                    <input type="date" id="startdate"></input>
                    <input type="time" id="starttime" step="3600"></input>
                </td>
            </tr>
            <tr>
                <td>結束時間: </td>
                <td>
                    <input type="date" id="enddate"></input>
                    <input type="time" id="endtime"step="3600"></input>
                </td>
            </tr>
            <tr>
                <td>時間長度: </td>
                <td>
                    <input id="days" style="width:3.5em" type="number" min="0">天
                    <input id="hours" style="width:2.5em" type="number" min="0" max="23">小時</input>
                </td>
            </tr>
            <tr><td><button onclick="request_new_path()">產生路徑</button></td></tr>
        <table>
    </div>
</div>

<style>
#controls-wrapper {
    position: absolute;
    width:100%;
    text-align:center;
}

#controls {
    font-family: 微軟正黑體, sans-serif;
    position: absolute;
    margin: 0 auto;
    top: 0%;
    left: 40%;
    z-index: 4;
    overflow: auto;
    display: inline;
    font-size: 0.95em;
}

#controls > * {
    font-family: 微軟正黑體, sans-serif;
    font-size: 0.95em;
}
</style>

<script>

var controls = $("#controls")[0];

controls.init = function()
{
    $("#startdate")[0].min = date2str(DATE_MIN);
    $("#startdate")[0].max = date2str(DATE_MAX);
    $("#enddate")[0].min = date2str(DATE_MIN);
    $("#enddate")[0].max = date2str(DATE_MAX);

    $("#startdate")[0].oninput = 
    $("#starttime")[0].oninput = 
    function(e){
        Session.startdate = new Date(`${startdate.value}T${starttime.value}`);
        if (Session.enddate < Session.startdate)
            Session.enddate = Session.startdate;
        controls.update();
    };

    $("#enddate")[0].oninput =
    $("#endtime")[0].oninput = 
    function(e){ 
        Session.enddate = new Date(`${enddate.value}T${endtime.value}`);
        if (Session.startdate > Session.enddate)
            Session.startdate = Session.enddate;
        controls.update();
    };

    $("#days")[0].oninput =
    $("#hours")[0].oninput =
    function(e){ 
        Session.enddate = new Date(Session.startdate);
        Session.enddate.setDate(Session.enddate.getDate() + Number($("#days")[0].value));
        Session.enddate.setHours(Session.enddate.getHours() + Number($("#hours")[0].value)); 
        if (Session.enddate > DATE_MAX)
            Session.enddate = DATE_MAX;
        controls.update();
    };
}

controls.update = function()
{
    $("#startdate")[0].value = date2str(Session.startdate);
    $("#starttime")[0].value = time2str(Session.startdate);
    $("#enddate")[0].value = date2str(Session.enddate);
    $("#endtime")[0].value = time2str(Session.enddate);
    $("#startloc")[0].innerText = loc2str(Session.startloc);
    var hrs = (Session.enddate - Session.startdate)/1000/3600;
    $("#days")[0].value = Math.floor(hrs/24);
    $("#hours")[0].value = hrs%24;
}

controls.init();
controls.update();

</script>