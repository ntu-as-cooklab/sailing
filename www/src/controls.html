<div id="controls" class="leaflet-popup-content-wrapper" style="position:absolute">
    <table class="leaflet-popup-content">
        <tr><td>起始地點: </td><td id="startloc"></td></tr>
        <tr>
            <td>起始時間: </td>
            <td>
                <input type="date" id="startdate"></input>
                <input type="time" id="starttime" step="3600"></input>
            </td>
        </tr>
        <tr>
            <td>結束時間: </td>
            <td>
                <input type="date" id="enddate"></input>
                <input type="time" id="endtime"step="3600"></input>
            </td>
        </tr>
        <tr>
            <td>時間長度: </td>
            <td>
                <input id="days" style="width:3.5em" type="number" min="0">天
                <input id="hours" style="width:2.5em" type="number" min="0" max="23">小時</input>
            </td>
        </tr>
        <tr><td><button onclick="request_new_path()">產生路徑</button></td></tr>
    <table>
</div>

<style>
#controls {
    font-family: 微軟正黑體, sans-serif;
    position: absolute;
    margin: 0 auto;
    top: 0%;
    z-index: 4;
    overflow: auto;
    display: inline;
}

#controls > * {
    font-family: 微軟正黑體, sans-serif;
    font-size: 1.5vh;
}
</style>

<script>

var controls = $("#controls")[0];

controls.init = function()
{
    $("#startdate")[0].min = date2str(DATE_MIN);
    $("#startdate")[0].max = date2str(DATE_MAX);
    $("#enddate")[0].min = date2str(DATE_MIN);
    $("#enddate")[0].max = date2str(DATE_MAX);
    var hrs = (DATE_MAX - DATE_MIN)/1000/3600;
    $("#days")[0].max = Math.floor(hrs/24);
    $("#hours")[0].max = hrs%24;

    $("#startdate")[0].oninput = 
    $("#starttime")[0].oninput = 
        function(e){
            Session.startdate = new Date(`${startdate.value}T${starttime.value}`);
            if (Session.enddate < Session.startdate)
                Session.enddate = Session.startdate;
            controls.update();
        };

    $("#enddate")[0].oninput =
    $("#endtime")[0].oninput = 
        function(e){ 
            Session.enddate = new Date(`${enddate.value}T${endtime.value}`);
            if (Session.startdate > Session.enddate)
                Session.startdate = Session.enddate;
            controls.update();
        };
}

controls.update = function()
{
    $("#startdate")[0].value = date2str(Session.startdate);
    $("#starttime")[0].value = time2str(Session.startdate);
    $("#enddate")[0].value = date2str(Session.enddate);
    $("#endtime")[0].value = time2str(Session.enddate);
    $("#startloc")[0].innerText = loc2str(Session.startloc);
    var hrs = (Session.enddate - Session.startdate)/1000/3600;
    $("#days")[0].value = Math.floor(hrs/24);
    $("#hours")[0].value = hrs%24;
}

controls.init();
controls.update();

</script>